!function(){"use strict";const e=e=>{e.querySelectorAll("[name]").forEach((e=>{e.matches("input[type=radio], input[type=checkbox]")?e.checked=!1:e.value=""})),e.dispatchEvent(new Event("change"))},t=e=>{const t=new FormData(e);return Object.fromEntries([...t.entries()].filter((([e,t])=>""!==t)))},n=(e,t,n)=>{if(e.getAttribute("name")!==t)throw Error();e.matches("input[type=radio], input[type=checkbox]")?e.getAttribute("value")===n&&(e.checked=!0):e.value=n},r=(t,r)=>{const o=(e=>[...e.querySelectorAll("[name]")].map((e=>[e.getAttribute("name"),e])).reduce(((e,[t,n])=>{if(t in e){const r=e[t];return Array.isArray(r)?(r.push(n),e):(e[t]=[r,n],e)}return e[t]=n,e}),Object.create(null)))(t);e(t),r&&Object.entries(r).forEach((([e,t])=>{if(Array.isArray(t))throw Error();const r=o[e];r&&(Array.isArray(r)?r.forEach((r=>n(r,e,t))):n(r,e,t))}))},o="e4c13b47d64f3864376e4c6dafb753bf619f08bb";const a=(e,t)=>{const n=new FormData(e),r=e.querySelector(`.group-${t}-legal-entity`),o=e.querySelector(`.group-${t}-private-person`),a=n.get(`${t}-type`);r.hidden="legal-entity"!==a,o.hidden="private-person"!==a},c=(e,t)=>{const n=window.terminals,r=window.places,o=new FormData(e),a=o.get(`${t}-place`),c=o.get(`${t}-point`),i=o.get(`${t}-point-client-address`).trim(),s=e.elements[`${t}-point-client-address`];let l="Терминал перевозчика";const d=e.querySelector(`.${t}-terminal-control`),g=e.querySelector(`.${t}-client-control`),u=e.querySelector(`.${t}-pickup-control`),p=e.querySelector(`.${t}-point-terminal-title`);e.querySelector(`.group-${t}-point-client-address`).hidden=!c||c===`${t}-point-terminal`,a?a in n?(d.hidden=!1,g.hidden=!1,u.hidden=!0,l=`Терминал перевозчика: ${window.terminals[a]}`,(""===i||Object.values(r).includes(i))&&(s.value=r[a]+" ")):(d.hidden=!0,g.hidden=!0,u.hidden=!1):(d.hidden=!1,g.hidden=!1,u.hidden=!1),p.textContent=l},i=[],s=document.forms.order;(e=>{const n=e.getAttribute("name");if(i.find((t=>t.form===e)))throw Error("Persistance already enabled for form");const o=()=>{const r=t(e);sessionStorage.setItem(`form[name=${n}]`,JSON.stringify(r))},a=()=>{const t=JSON.parse(sessionStorage.getItem(`form[name=${n}]`));r(e,t),e.dispatchEvent(new Event("change"))};i.push({form:e,handleFormChange:o,handleDOMContentLoaded:a}),e.addEventListener("change",o),document.addEventListener("DOMContentLoaded",a)})(s),function(e){e.querySelectorAll("[data-suggestion-type]").forEach((e=>{const t={address:"ADDRESS",name:"NAME",email:"EMAIL"}[e.dataset.suggestionType];if(!t)throw Error();$(e).suggestions({token:o,type:t})}));const t=t=>{const n=e.elements[`${t}`];$(n).suggestions({token:o,type:"PARTY",onSelect:function(n){const r=e.elements[`${t}-OGRN`],o=e.elements[`${t}-INN`],a=e.elements[`${t}-KPP`],c=e.elements[`${t}-address`];console.log(n);const i=n.data.address.value;"INDIVIDUAL"===n.data.type&&(r.value=n.data.ogrn,o.value=n.data.inn,a.value="",c.value=i),"LEGAL"===n.data.type&&(r.value=n.data.ogrn,o.value=n.data.inn,a.value=n.data.kpp,c.value=i)}})};t("consigner"),t("consignee"),t("payer")}(s);const l=s.elements["consigner-is-payer"],d=s.elements["consignee-is-payer"];s.addEventListener("change",(e=>{(e=>{e&&(e.target===l&&l.checked&&(d.checked=!1),e.target===d&&d.checked&&(l.checked=!1))})(e),(e=>{a(e,"consigner"),a(e,"consignee"),a(e,"payer")})(s),(e=>{const t=new FormData(e);["consigner","consignee"].forEach((n=>{const r=e.querySelector(`.${n}-paying-contact`),o=t.get(`${n}-type`),a=t.get(`${n}-is-payer`)===`${n}-is-payer`&&"legal-entity"===o;r.hidden=!a}));const n="consigner-is-payer"===t.get("consigner-is-payer"),r="consignee-is-payer"===t.get("consignee-is-payer");e.querySelector(".section-payer").hidden=n||r})(s),(e=>{c(e,"loading"),c(e,"unloading")})(s),(e=>{e.querySelectorAll(".control--required").forEach((e=>{const t=e.querySelector("input, textarea, select");t.matches("[hidden] *")?t.removeAttribute("required"):t.setAttribute("required","")}))})(s)}));let g=!1;s.addEventListener("submit",(n=>{if(n.preventDefault(),g)return;g=!0;const r=s.querySelector("button[type=submit]");r.classList.add("button--submiting"),(e=>{const n=t(e),r=e.getAttribute("name");localStorage.setItem(`form[name=${r}]`,JSON.stringify(n))})(s);const o=(e=>{const t=new FormData(e),n=Object.create(null),r=window.places,o=Object.create(null);Object.entries({name:"cargo",weight:"cargo-weight",volume:"cargo-volume",qty:"cargo-qty",condition:"cargo-condition",value:"cargo-value",insurance:"insurance"}).forEach((([e,n])=>{o[e]=t.get(n)})),n.cargo=o,["consigner","consignee","payer"].forEach((e=>{if("payer"===e&&(Boolean(t.get("consigner-is-payer"))||Boolean(t.get("consignee-is-payer"))))return;const r=Object.create(null),o=t.get(`${e}-type`);r.type=o,"legal-entity"===o&&Object.entries({name:`${e}`,INN:`${e}-INN`,KPP:`${e}-KPP`,OGRN:`${e}-OGRN`,address:`${e}-address`,cargoContactTel:`${e}-cargo-contact-tel`,cargoContactFio:`${e}-cargo-contact-fio`,payingContactTel:`${e}-paying-contact-tel`,payingContactFio:`${e}-paying-contact-fio`}).forEach((([n,o])=>{("payer"!==e||"cargoContactTel"!==n&&"cargoContactFio"!==n)&&(r[n]=t.get(o))})),"private-person"===o&&Object.entries({name:`${e}-fio`,tel:`${e}-tel`}).forEach((([e,n])=>{r[e]=t.get(n)})),["consigner","consignee"].includes(e)&&(r.isPayer=Boolean(t.get(`${e}-is-payer`))),n[e]=r})),["loading","unloading"].forEach((e=>{const o=Object.create(null);Object.entries({date:`${e}-date`,time:`${e}-time`,place:`${e}-place`,point:`${e}-point`,pointClientAddress:`${e}-point-client-address`}).forEach((([e,n])=>{o[e]="place"!==e?t.get(n):r[t.get(n)]??""})),n[e]=o})),n.paymentForm=t.get("payment-form"),n.memo=t.get("memo");const a=Object.create(null);return["fio","tel","email"].forEach((e=>{a[e]=t.get(`order-author-${e}`)})),n.author=a,n})(s),a=new FormData;a.append("data",JSON.stringify(o));const c=s.querySelector("button[type=submit]").closest(".control-group");c.classList.remove("control-group--error"),fetch("php/mailer/send.php",{method:"POST",body:a}).then((function(e){if(!e.ok)throw Error("При отправке заявки возникла ошибка, заявка не отправлена.");return e.json()})).then((function(t){if(console.log(t),"success"!==t.result)throw Error("При отправке заявки возникла ошибка почтового сервера, заявка не отправлена.");e(s),window.location.assign("order-ok.html")})).catch((e=>{console.error(e.message),c.classList.add("control-group--error")})).finally((()=>{r.classList.remove("button--submiting"),g=!1}))}));s.querySelector(".suggest-helper--clean-form").addEventListener("click",(()=>{e(s)}));s.querySelector(".suggest-helper--fill-form").addEventListener("click",(()=>(e=>{const t=e.getAttribute("name"),n=localStorage.getItem(`form[name=${t}]`);if(n){const t=JSON.parse(n);r(e,t)}e.dispatchEvent(new Event("change"))})(s)))}();
//# sourceMappingURL=order.js.map
